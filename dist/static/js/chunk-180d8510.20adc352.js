(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-180d8510"],{"0da8":function(e,t,a){"use strict";a("135e")},"135e":function(e,t,a){},"2f6b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"search_box"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.open_add_warehouse}},[e._v("新增")])],1),a("div",{staticClass:"table_box"},[a("el-table",{staticClass:"table",attrs:{data:e.list,stripe:"",border:""}},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center",label:"序号"}}),a("el-table-column",{attrs:{align:"center",label:"仓库封面",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.pictureUrl?a("el-image",{attrs:{"preview-src-list":[t.row.pictureUrl],src:t.row.pictureUrl}}):a("el-image",{attrs:{"preview-src-list":[e.default_img],src:e.default_img}})]}}])}),a("el-table-column",{attrs:{prop:"whseName",width:"200",label:"仓库名称"}}),a("el-table-column",{attrs:{prop:"whseNumber",label:"仓库编号",width:"150"}}),a("el-table-column",{attrs:{label:"仓库位置",prop:"whseLocation"}}),a("el-table-column",{attrs:{prop:"whseHeader",label:"负责人",align:"center",width:"100"}}),a("el-table-column",{attrs:{prop:"creator",label:"创建人",align:"center",width:"100"}}),a("el-table-column",{attrs:{sortable:"",prop:"createTime",align:"center",label:"创建日期",width:"200"}}),a("el-table-column",{attrs:{label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.handleEdit(t.$index,t.row.whseId)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row.whseId)}}},[e._v("删除")])]}}])})],1)],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:e.warehouseId?"编辑仓库":"新增仓库","element-loading-text":"上传中",visible:e.show_dialog,width:"550px"},on:{"update:visible":function(t){e.show_dialog=t}}},[a("el-form",{attrs:{model:e.warehouse_form}},[a("el-form-item",{attrs:{label:"仓库封面","label-width":"120px"}},[a("el-upload",{staticClass:"cover-uploader",attrs:{action:e.upload_url,multiple:!1,headers:{token:e.token},data:{source:1,sourceId:e.id},"show-file-list":!1,accept:"image/jpeg,image/jpg,image/png","before-upload":e.limitSize,"on-success":e.cover_upload_success}},[e.warehouse_form.img?a("img",{staticClass:"avatar avatar-uploader-icon",attrs:{src:e.warehouse_form.img.url}}):e._e(),e.warehouse_form.img?a("i",{staticClass:"el-icon-error",on:{click:function(t){t.stopPropagation(),e.warehouse_form.img=""}}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-form-item",{attrs:{label:"仓库名称","label-width":"120px",required:"",clearable:""}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入仓库名称",maxlength:"10"},model:{value:e.warehouse_form.name,callback:function(t){e.$set(e.warehouse_form,"name","string"===typeof t?t.trim():t)},expression:"warehouse_form.name"}})],1),a("el-form-item",{attrs:{label:"仓库编号","label-width":"120px",required:"",clearable:""}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入仓库编号",maxlength:"20"},model:{value:e.warehouse_form.num,callback:function(t){e.$set(e.warehouse_form,"num","string"===typeof t?t.trim():t)},expression:"warehouse_form.num"}}),a("el-button",{staticStyle:{"margin-left":"4px"},attrs:{type:"primary"},on:{click:e.autoNum}},[e._v("自动生成")])],1),a("el-form-item",{attrs:{label:"仓库负责人","label-width":"120px",required:""}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入仓库负责人",maxlength:"50"},model:{value:e.warehouse_form.header,callback:function(t){e.$set(e.warehouse_form,"header","string"===typeof t?t.trim():t)},expression:"warehouse_form.header"}})],1),a("el-form-item",{attrs:{label:"仓库位置","label-width":"120px",required:""}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入仓库位置",maxlength:"50"},model:{value:e.warehouse_form.local,callback:function(t){e.$set(e.warehouse_form,"local","string"===typeof t?t.trim():t)},expression:"warehouse_form.local"}})],1),e.people_list&&e.people_list.length?a("el-form-item",{attrs:{label:"可视人","label-width":"120px",required:""}},[a("el-tree",{ref:"people_tree",staticStyle:{"max-height":"400px",overflow:"auto"},attrs:{data:e.people_list,"show-checkbox":"","node-key":"userId","check-on-click-node":!0,props:{label:"name",children:"sonDepartmentIds"}}})],1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.show_dialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.add_warehouse}},[e._v("确 定")])],1)],1)],1)},s=[],o=a("2909"),i=(a("d81d"),a("99af"),a("b0c0"),a("4de4"),a("a880"));function l(e){return i["a"].get("/warehouse/list",e)}function n(e){return i["a"].post("/warehouse/add",e)}function u(e){return i["a"].post("/warehouse/update",e)}function c(e){return i["a"].post("/warehouse/disable",e)}function h(e){return i["a"].post("/warehouse/createWarehouseNumber",e)}function d(e){return i["a"].post("/common/getId",e)}function m(e){return i["a"].get("/warehouse/checked",e)}function p(e){return i["a"].get("/user/getOrganizational",e)}function f(e){return e.map((function(e){e.userJwtVos&&e.userJwtVos.length&&(e.sonDepartmentIds=[].concat(Object(o["a"])(e.sonDepartmentIds),Object(o["a"])(e.userJwtVos))),e.name||(e.userId=e.departmentId,e.name=e.departmentName),e.userJwtVos&&e.sonDepartmentIds.length&&(e.sonDepartmentIds=f(e.sonDepartmentIds))})),e}var w={data:function(){return{list:[],loading:!1,show_dialog:!1,warehouseId:"",id:"",people_list:[],checked_tree:[],warehouse_form:{img:"",name:"",num:"",local:"",header:""}}},computed:{userInfo:function(){return this.$store.state.user.userInfo},default_img:function(){return"//cloudosstest.hugehuge.net/ierp/images/static/warehouse_default.png"},upload_url:function(){return"//192.168.1.155:28081/picture/uploadImg"},token:function(){return this.$store.state.user.token}},mounted:function(){var e=this;this.getList(),p().then((function(t){e.people_list=f(t)}))},methods:{limitSize:function(e){if(e.size>2097152)return this.$message.error("上传图片大于2M"),!1;this.loading=!0},cover_upload_success:function(e){200==e.code&&(this.warehouse_form.img=e.data,this.loading=!1)},autoNum:function(){var e=this;h().then((function(t){e.warehouse_form.num=t}))},getList:function(){var e=this;l().then((function(t){e.list=t}))},open_add_warehouse:function(){var e=this;this.warehouse_form={img:"",name:"",num:"",local:"",header:""},this.warehouseId="",this.id?(this.show_dialog=!0,this.$refs.people_tree.setCheckedKeys([])):d({tableName:"INV_WHSE"}).then((function(t){e.id=t,e.show_dialog=!0,e.$nextTick((function(){e.$refs.people_tree.setCheckedKeys([])}))}))},add_warehouse:function(){var e=this,t=this.warehouse_form;if(t.name)if(t.num)if(t.header)if(t.local){t={whseHeader:t.header,whseName:t.name,whseNumber:t.num,whseLocation:t.local,pictureId:t.img?t.img.id:""};if(this.people_list&&this.people_list.length){var a=this.$refs.people_tree.getCheckedKeys();if(a=a.filter((function(e){return-1!=e.indexOf("BUR")})),0==a.length)return void this.$message.error("请至少选择一个可视人");t.userIds=a}this.warehouseId?(t.whseId=this.warehouseId,u(t).then((function(t){e.$message.success("编辑成功"),e.getList(),e.show_dialog=!1}))):(t.whseId=this.id,n(t).then((function(t){e.$message.success("新增成功"),e.getList(),e.id="",e.show_dialog=!1})))}else this.$message.error("请输入仓库位置");else this.$message.error("请输入仓库负责人");else this.$message.error("请输入仓库编号");else this.$message.error("请输入仓库名称")},handleEdit:function(e,t){var a=this,r=this.list[e];this.warehouseId=r.whseId;var s={img:"",name:r.whseName,num:r.whseNumber,local:r.whseLocation||"",header:r.whseHeader};r.pictureUrl&&(s.img={id:r.pictureId,url:r.pictureUrl}),this.warehouse_form=s,m({whseId:r.whseId}).then((function(e){a.$refs.people_tree.setCheckedKeys(e)})),this.show_dialog=!0},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该仓库, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c({whseId:e}).then((function(e){t.$message.success("删除成功"),t.getList()}))}))}}},g=w,_=(a("0da8"),a("2877")),b=Object(_["a"])(g,r,s,!1,null,"e741b722",null);t["default"]=b.exports}}]);